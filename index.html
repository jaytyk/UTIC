<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ë¡œ ê¸°ë°˜ UTIC CCTV ë·°ì–´ (API ì„ íƒì  ì‚¬ìš©)</title>
    
    <style>
        /* (ì´ì „ CSS ìŠ¤íƒ€ì¼ ìœ ì§€) */
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; background-color: #f4f4f4; }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; display: flex; gap: 20px; }
        h1 { text-align: center; color: #333; }
        
        /* ì¢Œì¸¡ ì œì–´íŒ ì˜ì—­ */
        .sidebar { width: 350px; flex-shrink: 0; background-color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        
        .api-input-section { margin-bottom: 20px; padding: 10px; border: 1px dashed #ccc; border-radius: 4px; background-color: #e8f5e9; }
        .api-input-section input { margin-bottom: 5px; }
        .api-input-section button { padding: 5px 10px; margin-top: 5px; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .api-input-section button:hover { background-color: #388e3c; }

        #search-button { width: 100%; padding: 10px; background-color: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
        #search-button:hover:not(:disabled) { background-color: #1976d2; }
        #search-button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        #map-area { margin-top: 20px; height: 300px; border: 1px solid #ccc; border-radius: 4px; background-color: #eee; }
        .map-placeholder { padding: 10px; text-align: center; color: #666; }
        #cctv-count { font-weight: bold; margin-top: 10px; }

        /* ìš°ì¸¡ ë·°ì–´ ì˜ì—­ */
        .viewer-area { flex-grow: 1; }
        #cctv-viewer { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .cctv-item { background-color: #000; position: relative; overflow: hidden; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); min-height: 200px; }
        .cctv-item iframe { width: 100%; height: 100%; border: none; }
        .cctv-title { position: absolute; top: 5px; left: 5px; color: white; background-color: rgba(0, 0, 0, 0.5); padding: 2px 5px; border-radius: 3px; font-size: 12px; }

        /* ê°€ë¡œ 2~4ê°œ ë ˆì´ì•„ì›ƒ */
        .cols-2 .cctv-item { width: calc(50% - 5px); }
        .cols-3 .cctv-item { width: calc(33.333% - 7px); }
        .cols-4 .cctv-item { width: calc(25% - 8px); }
    </style>
</head>
<body>

    <header>
        <h1>ê²½ë¡œ ê¸°ë°˜ UTIC CCTV ë·°ì–´</h1>
    </header>

    <div class="container">
        <div class="sidebar">
            
            <div class="api-input-section">
                <h3>ğŸ”‘ API í‚¤ ì„¤ì • (ë¡œì»¬ ì €ì¥)</h3>
                <div class="input-group">
                    <label for="utic-key-input">UTIC API í‚¤ (í•„ìˆ˜):</label>
                    <input type="text" id="utic-key-input" placeholder="UTIC í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="input-group">
                    <label for="kakao-key-input">ì¹´ì¹´ì˜¤ë§µ JavaScript API í‚¤ (ì„ íƒ):</label>
                    <input type="text" id="kakao-key-input" placeholder="ì§€ë„ í‘œì‹œë¥¼ ì›í•˜ë©´ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="saveApiKeys()">API í‚¤ ì €ì¥ ë° ì„œë¹„ìŠ¤ ë¡œë“œ</button>
                <p style="font-size: 12px; margin-top: 5px;">* UTIC í‚¤ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤. ì¹´ì¹´ì˜¤ í‚¤ ì—†ì´ ì €ì¥ ì‹œ ì§€ë„ ê¸°ëŠ¥ì€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</p>
            </div>

            <div id="service-controls" style="display: none;">
                <h2>ê²½ë¡œ ì¢Œí‘œ ì…ë ¥ ë° ê²€ìƒ‰</h2>
                <p style="font-size: 12px; color: #666;">* ì¹´ì¹´ì˜¤ í‚¤ê°€ ì—†ìœ¼ë©´ ì¥ì†Œ ì´ë¦„ ê²€ìƒ‰ ëŒ€ì‹  ì¢Œí‘œë¥¼ ì§ì ‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (WGS84)</p>
                <div class="input-group">
                    <label for="start-lat">ì¶œë°œì§€ (ìœ„ë„/ê²½ë„):</label>
                    <input type="text" id="start-lat" placeholder="ìœ„ë„ (ì˜ˆ: 37.5665)">
                    <input type="text" id="start-lon" placeholder="ê²½ë„ (ì˜ˆ: 126.9780)">
                </div>

                <div class="input-group">
                    <label for="end-lat">ë„ì°©ì§€ (ìœ„ë„/ê²½ë„):</label>
                    <input type="text" id="end-lat" placeholder="ìœ„ë„ (ì˜ˆ: 35.1165)">
                    <input type="text" id="end-lon" placeholder="ê²½ë„ (ì˜ˆ: 129.0400)">
                </div>

                <div class="input-group">
                    <label for="range-select">ê²½ë¡œ ì£¼ë³€ ê²€ìƒ‰ ë²”ìœ„:</label>
                    <select id="range-select">
                        <option value="100">100m</option>
                        <option value="200">200m</option>
                        <option value="300" selected>300m</option>
                        <option value="500">500m</option>
                        <option value="1000">1000m (1km)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="column-count">í™”ë©´ ê°€ë¡œ ë°°ì—´ ê°œìˆ˜:</label>
                    <select id="column-count">
                        <option value="2">2ê°œ</option>
                        <option value="3" selected>3ê°œ</option>
                        <option value="4">4ê°œ</option>
                    </select>
                </div>

                <button id="search-button" onclick="findRouteAndCCTVs()">UTIC CCTV ê²€ìƒ‰ ì‹œì‘</button>
            </div>

            <div id="map-area">
                 <div class="map-placeholder">
                    API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì§€ë„ ë˜ëŠ” ê²€ìƒ‰ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                 </div>
            </div>
            <p id="cctv-count"></p>
        </div>

        <div class="viewer-area">
            <h2>ê²½ë¡œ CCTV í™”ë©´</h2>
            <div id="cctv-viewer" class="cols-3">
                <p>UTIC API í‚¤ë¥¼ ì…ë ¥í•˜ê³  ê²½ë¡œë¥¼ ì„¤ì •í•˜ì—¬ CCTVë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.</p>
            </div>
        </div>
    </div>

    <script>
        const UTIC_BASE_STREAM_URL = 'https://www.utic.go.kr/jsp/map/cctvStream.jsp?';
        const KAKAO_KEY_STORAGE_KEY = 'kakaoMapApiKey';
        const UTIC_KEY_STORAGE_KEY = 'uticApiKey';

        let KAKAO_API_KEY = localStorage.getItem(KAKAO_KEY_STORAGE_KEY) || null;
        let UTIC_API_KEY = localStorage.getItem(UTIC_KEY_STORAGE_KEY) || null;
        let isKakaoLoaded = false; // ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì—¬ë¶€

        // ì¹´ì¹´ì˜¤ ì§€ë„ ë° ì„œë¹„ìŠ¤ ê°ì²´ (ë¡œë“œ í›„ ì´ˆê¸°í™”ë¨)
        let map = null;
        let ps = null; 
        let routePolyline = null;
        let markerStart = null;
        let markerEnd = null;

        // ê¸°ë³¸ ê²½ë¡œ ì¢Œí‘œ (ì„œìš¸ì—­ê³¼ ë¶€ì‚°ì—­ ëŒ€ëµì ì¸ ì¢Œí‘œ)
        const DEFAULT_START_LAT = 37.5665;
        const DEFAULT_START_LON = 126.9780;
        const DEFAULT_END_LAT = 35.1165;
        const DEFAULT_END_LON = 129.0400;


        /**
         * API í‚¤ ì…ë ¥ í•„ë“œë¥¼ ë¡œì»¬ ì €ì¥ì†Œ ê°’ìœ¼ë¡œ ì±„ìš°ê³ , í‚¤ê°€ ìˆìœ¼ë©´ ì„œë¹„ìŠ¤ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function initializeApiInputs() {
            document.getElementById('kakao-key-input').value = KAKAO_API_KEY || '';
            document.getElementById('utic-key-input').value = UTIC_API_KEY || '';
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('start-lat').value = DEFAULT_START_LAT;
            document.getElementById('start-lon').value = DEFAULT_START_LON;
            document.getElementById('end-lat').value = DEFAULT_END_LAT;
            document.getElementById('end-lon').value = DEFAULT_END_LON;

            if (UTIC_API_KEY) {
                // UTIC í‚¤ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ì„œë¹„ìŠ¤ ë¡œë“œ ì‹œë„
                loadKakaoMapScript(KAKAO_API_KEY);
            }
        }
        
        /**
         * API í‚¤ë¥¼ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥í•˜ê³  ì„œë¹„ìŠ¤ ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤.
         */
        function saveApiKeys() {
            const kakaoKey = document.getElementById('kakao-key-input').value.trim();
            const uticKey = document.getElementById('utic-key-input').value.trim();

            if (!uticKey) {
                alert('UTIC API í‚¤ëŠ” í•„ìˆ˜ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            localStorage.setItem(UTIC_KEY_STORAGE_KEY, uticKey);
            UTIC_API_KEY = uticKey;

            // ì¹´ì¹´ì˜¤ í‚¤ëŠ” ì„ íƒì  ì €ì¥
            if (kakaoKey) {
                localStorage.setItem(KAKAO_KEY_STORAGE_KEY, kakaoKey);
                KAKAO_API_KEY = kakaoKey;
            } else {
                localStorage.removeItem(KAKAO_KEY_STORAGE_KEY);
                KAKAO_API_KEY = null;
            }

            alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆê³  ì„œë¹„ìŠ¤ ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            loadKakaoMapScript(KAKAO_API_KEY);
        }

        /**
         * ì¹´ì¹´ì˜¤ë§µ JavaScript SDKë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤. (ì„ íƒì )
         */
        function loadKakaoMapScript(key) {
            document.getElementById('service-controls').style.display = 'block'; // UTIC í‚¤ë§Œ ìˆìœ¼ë©´ í™œì„±í™”
            
            if (key) {
                // ì¹´ì¹´ì˜¤ í‚¤ê°€ ìˆì„ ê²½ìš°ì—ë§Œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
                const existingScript = document.getElementById('kakao-map-script');
                if (existingScript) existingScript.remove(); // ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ì œê±° (í‚¤ê°€ ë°”ë€Œì—ˆì„ ê²½ìš° ëŒ€ë¹„)
                
                const script = document.createElement('script');
                script.id = 'kakao-map-script';
                script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${key}&libraries=services`;
                script.onload = () => {
                    kakao.maps.load(initializeServices);
                };
                script.onerror = () => {
                     alert('ì¹´ì¹´ì˜¤ë§µ API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§€ë„ ê¸°ëŠ¥ ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤.');
                     initializeServices(false);
                }
                document.head.appendChild(script);

            } else {
                // ì¹´ì¹´ì˜¤ í‚¤ê°€ ì—†ìœ¼ë©´ ì§€ë„ ì—†ì´ ì„œë¹„ìŠ¤ í™œì„±í™”
                initializeServices(false); 
            }
        }

        /**
         * ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ í™œì„±í™”í•©ë‹ˆë‹¤.
         * @param {boolean} mapEnabled - ì¹´ì¹´ì˜¤ë§µì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ ì—¬ë¶€
         */
        function initializeServices(mapEnabled = true) {
            isKakaoLoaded = mapEnabled;
            const mapArea = document.getElementById('map-area');
            
            if (isKakaoLoaded) {
                // ì§€ë„ í™œì„±í™”
                mapArea.innerHTML = '';
                const mapContainer = mapArea;
                const defaultCenter = new kakao.maps.LatLng(DEFAULT_START_LAT, DEFAULT_START_LON);
                const mapOption = { center: defaultCenter, level: 13 };
                
                map = new kakao.maps.Map(mapContainer, mapOption);
                ps = new kakao.maps.services.Places(); 
                
                document.getElementById('search-button').textContent = 'ê²½ë¡œ ê²€ìƒ‰ ë° CCTV ì¡°íšŒ';
                document.getElementById('cctv-viewer').innerHTML = '<p>ì¶œë°œì§€/ë„ì°©ì§€ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>';
            } else {
                // ì§€ë„ ë¹„í™œì„±í™” ì‹œ Placeholder í‘œì‹œ
                mapArea.innerHTML = '<div class="map-placeholder">ì¹´ì¹´ì˜¤ë§µ í‚¤ê°€ ì—†ì–´ ì§€ë„ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (ì¢Œí‘œë§Œìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥)</div>';
                document.getElementById('search-button').textContent = 'UTIC CCTV ê²€ìƒ‰ ì‹œì‘ (ì§€ë„ ë¹„í™œì„±í™”)';
                document.getElementById('cctv-viewer').innerHTML = '<p>ì¢Œí‘œ ì…ë ¥ í›„ UTIC CCTV ê²€ìƒ‰ì„ ì‹œì‘í•˜ì„¸ìš”.</p>';
            }
            
            document.getElementById('search-button').disabled = false;
        }

        // --- ë©”ì¸ íë¦„ í•¨ìˆ˜ ---
        
        async function findRouteAndCCTVs() {
            if (!UTIC_API_KEY) {
                alert('UTIC API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ê³  ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const startLat = parseFloat(document.getElementById('start-lat').value);
            const startLon = parseFloat(document.getElementById('start-lon').value);
            const endLat = parseFloat(document.getElementById('end-lat').value);
            const endLon = parseFloat(document.getElementById('end-lon').value);
            const searchRange = document.getElementById('range-select').value;

            if (isNaN(startLat) || isNaN(startLon) || isNaN(endLat) || isNaN(endLon)) {
                alert('ì˜¬ë°”ë¥¸ ì¶œë°œì§€/ë„ì°©ì§€ ì¢Œí‘œ(ìœ„ë„, ê²½ë„)ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const searchButton = document.getElementById('search-button');
            searchButton.disabled = true;
            searchButton.textContent = 'UTIC API ì¡°íšŒ ì¤‘...';
            document.getElementById('cctv-viewer').innerHTML = '<p>UTIC CCTV ì •ë³´ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...</p>';
            document.getElementById('cctv-count').textContent = '';

            try {
                // 1. UTIC APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œ ìƒì˜ CCTV ì¡°íšŒ
                // UTIC API ëª…ì„¸ì— ë”°ë¼ range íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€ (100m ë‹¨ìœ„)
                const uticCctvApiUrl = `https://openapi.utic.go.kr/api/getRouteCctvList?key=${UTIC_API_KEY}&startLat=${startLat}&startLon=${startLon}&endLat=${endLat}&endLon=${endLon}&range=${searchRange}`;
                
                // CORS ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„± ë†’ìŒ
                const response = await fetch(uticCctvApiUrl);
                
                if (!response.ok) {
                    throw new Error(`UTIC API í˜¸ì¶œ ì‹¤íŒ¨: ìƒíƒœ ì½”ë“œ ${response.status}. API í‚¤ë‚˜ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.`);
                }
                
                const data = await response.json();
                
                // 2. UTIC API ê²°ê³¼ì—ì„œ CCTV ëª©ë¡ ì¶”ì¶œ (UTIC API ì‘ë‹µ í˜•ì‹ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
                // ì‹¤ì œ UTIC ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.
                const cctvList = data.cctvList || []; 

                // 3. ì§€ë„ì— ê²½ë¡œì™€ ë§ˆì»¤ í‘œì‹œ (ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì‹œì—ë§Œ ì‹¤í–‰)
                if (isKakaoLoaded) {
                    const startCoords = { x: startLon, y: startLat };
                    const endCoords = { x: endLon, y: endLat };
                    drawMapRoute(startCoords, endCoords, cctvList);
                }
                
                // 4. CCTV ë·°ì–´ ë Œë”ë§
                renderCCTVViewer(cctvList);

            } catch (error) {
                console.error("ì„œë¹„ìŠ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                document.getElementById('cctv-viewer').innerHTML = `<p style="color: red;">ì˜¤ë¥˜ ë°œìƒ: ${error.message}. (ì£¼ë¡œ CORS ë˜ëŠ” API ì‘ë‹µ í˜•ì‹ ë¬¸ì œ)</p>`;
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = 'UTIC CCTV ê²€ìƒ‰ ì‹œì‘';
            }
        }
        
        /**
         * ì¹´ì¹´ì˜¤ë§µì— ê²½ë¡œ ë° ë§ˆì»¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. (ì¹´ì¹´ì˜¤ë§µ ë¡œë“œ ì‹œì—ë§Œ í˜¸ì¶œë¨)
         */
        function drawMapRoute(startCoords, endCoords, cctvList) {
            // (ì´ì „ ì½”ë“œì™€ ë™ì¼í•œ ë¡œì§: ë§ˆì»¤ ë° ê²½ë¡œ ê·¸ë¦¬ê¸°)
            if (routePolyline) routePolyline.setMap(null);
            if (markerStart) markerStart.setMap(null);
            if (markerEnd) markerEnd.setMap(null);
            
            const bounds = new kakao.maps.LatLngBounds();
            const startPos = new kakao.maps.LatLng(startCoords.y, startCoords.x);
            const endPos = new kakao.maps.LatLng(endCoords.y, endCoords.x);
            bounds.extend(startPos);
            bounds.extend(endPos);
            
            map.setBounds(bounds);
            
            markerStart = new kakao.maps.Marker({ position: startPos, map: map, title: 'ì¶œë°œì§€' });
            markerEnd = new kakao.maps.Marker({ position: endPos, map: map, title: 'ë„ì°©ì§€' });

            routePolyline = new kakao.maps.Polyline({
                path: [startPos, endPos],
                strokeWeight: 5,
                strokeColor: '#FF0000',
                strokeOpacity: 0.7,
                strokeStyle: 'solid'
            });
            routePolyline.setMap(map);
            
            // CCTV ë§ˆì»¤ í‘œì‹œ 
            cctvList.forEach(cctv => {
                 if (cctv.lat && cctv.lon) {
                    const cctvPos = new kakao.maps.LatLng(cctv.lat, cctv.lon);
                    const cctvMarker = new kakao.maps.Marker({ 
                        position: cctvPos, 
                        map: map, 
                        title: cctv.cctvname || 'CCTV'
                    });
                    
                    kakao.maps.event.addListener(cctvMarker, 'click', function() {
                        document.getElementById(`cctv-${cctv.cctvid}`).scrollIntoView({ behavior: 'smooth' });
                    });
                 }
            });

            document.getElementById('cctv-count').textContent = `ê²½ë¡œ ì£¼ë³€ CCTV: ${cctvList.length}ê°œ ë°œê²¬ (ë²”ìœ„: ${document.getElementById('range-select').value}m)`;
        }

        /**
         * CCTV ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ë·°ì–´ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderCCTVViewer(cctvList) {
            const viewer = document.getElementById('cctv-viewer');
            const columnCount = document.getElementById('column-count').value;
            viewer.innerHTML = '';
            
            viewer.className = `cols-${columnCount}`;

            if (cctvList.length === 0) {
                 viewer.innerHTML = '<p>ê²½ë¡œ ì£¼ë³€ì—ì„œ CCTVë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì¡°ì •í•´ë³´ì„¸ìš”.</p>';
                 return;
            }

            cctvList.forEach(cctv => {
                // UTIC API ì‘ë‹µì—ì„œ í•„ìš”í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ ê¸°ì¡´ URL í˜•ì‹ì— ë§ê²Œ ì¬êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                // cctv ê°ì²´ì˜ í•„ë“œëª…ì€ UTIC API ëª…ì„¸ë¥¼ í™•ì¸í•˜ì—¬ ì •í™•í•˜ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.
                const params = `cctvid=${cctv.cctvid}&cctvname=${encodeURIComponent(cctv.cctvname)}&kind=${cctv.kind || 'EE'}&cctvip=${cctv.cctvip}&cctvch=${cctv.cctvch || 'undefined'}&id=undefined&cctvpasswd=undefined&cctvport=undefined&minX=${cctv.minX || ''}&minY=${cctv.minY || ''}&maxX=${cctv.maxX || ''}&maxY=${cctv.maxY || ''}`;
                const fullUrl = UTIC_BASE_STREAM_URL + params;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'cctv-item';
                itemDiv.id = `cctv-${cctv.cctvid}`;

                const titleSpan = document.createElement('span');
                titleSpan.className = 'cctv-title';
                titleSpan.textContent = cctv.cctvname;

                const iframe = document.createElement('iframe');
                iframe.src = fullUrl;
                iframe.setAttribute('loading', 'lazy'); 
                iframe.setAttribute('allow', 'autoplay');

                itemDiv.appendChild(iframe);
                itemDiv.appendChild(titleSpan);
                viewer.appendChild(itemDiv);
            });
            
            // ì§€ë„ ë¹„í™œì„±í™” ì‹œì—ëŠ” ëª©ë¡ ì¹´ìš´íŠ¸ë¥¼ ì—¬ê¸°ì— í‘œì‹œ
            if (!isKakaoLoaded) {
                 document.getElementById('cctv-count').textContent = `ê²½ë¡œ ì£¼ë³€ CCTV: ${cctvList.length}ê°œ ë°œê²¬ (ë²”ìœ„: ${document.getElementById('range-select').value}m)`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', initializeApiInputs);
    </script>
</body>
</html>
